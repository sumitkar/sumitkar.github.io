<!DOCTYPE html> <html lang=" en "><!-- Meta Pixel Code --> <script> !function(f,b,e,v,n,t,s) {if(f.fbq)return;n=f.fbq=function(){n.callMethod? n.callMethod.apply(n,arguments):n.queue.push(arguments)}; if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0'; n.queue=[];t=b.createElement(e);t.async=!0; t.src=v;s=b.getElementsByTagName(e)[0]; s.parentNode.insertBefore(t,s)}(window, document,'script', 'https://connect.facebook.net/en_US/fbevents.js'); fbq('init', '260451908193670'); fbq('track', 'PageView'); </script> <noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=260451908193670&ev=PageView&noscript=1" /></noscript> <!-- End Meta Pixel Code --> <head> <meta charset="utf-8"> <title>Automating your deployments using Ansible - Sumit Kar</title> <meta http-equip="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="description" content="Automating your deployments using Ansible" /> <meta name="keywords" content="Automating your deployments using Ansible, Sumit Kar, tech" /> <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml"> <meta content="Sumit Kar" property="og:site_name"> <meta property="fb:app_id" content="513486439531583" /> <meta content="Automating your deployments using Ansible - Sumit Kar" property="og:title"> <meta content="https://www.sumitkar.in/assets/img/posts/ansible-basics.jpg" property="og:image"> <meta content="article" property="og:type"> <meta content="Since the world is moving into the DevOps model, and the industry started focusing on automation, I thought of sharing something related to automation for deployment. Server-side deployment can be automated using several tools. One of which is Ansible. Ansible is a management tool that helps to maintain the cluster of machines." property="og:description"> <meta content="https://www.sumitkar.in/tech/2020/05/13/ansible-basics/" property="og:url"> <meta content="2020-05-13T15:33:23+00:00" property="article:published_time"> <meta content="https://www.sumitkar.in/about/" property="article:author"> <meta content="tech" property="article:section"> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@"> <meta name="twitter:creator" content="@"> <meta name="twitter:title" content="Automating your deployments using Ansible"> <meta content="Sumit Kar" property="og:site_name"> <meta name="twitter:url" content="https://www.sumitkar.in/tech/2020/05/13/ansible-basics/"> <meta name="twitter:description" content="'Technology Enthusiast | Photographer | Foodie | Numismatist'"> <link rel="stylesheet" href="/assets/css/main.css" /> <link rel="stylesheet" href="/assets/css/custom-style.css" /> <link rel="stylesheet" href="/assets/css/animate.css" /> <link rel="stylesheet" href="/assets/bower_components/lightgallery/dist/css/lightgallery.min.css" /> <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css"> <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css"> <link rel="stylesheet" href="/assets/bower_components/bootstrap/dist/css/bootstrap.min.css" /> <link rel="stylesheet" href="/assets/bower_components/font-awesome/web-fonts-with-css/css/fontawesome-all.min.css" /> <!-- Fonts--> <link href="//fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet"> <!-- Favicon --> <link rel="icon" href="https://www.sumitkar.in/assets/img/favicon.ico" type="image/gif" sizes="16x16"> <!-- Jquery --> <script src="//code.jquery.com/jquery-3.4.1.min.js" integrity="sha384-vk5WoKIaW/vJyUAd9n/wmopsmNhiy+L2Z+SBxGYnUkunIxVxAv/UtMOhba/xskxh" crossorigin="anonymous"></script> <script src="//unpkg.com/typewriter-effect@2.3.1/dist/core.js"></script> <!-- <script src="/assets/bower_components/jquery/dist/jquery.min.js"></script> --> <script src="/assets/bower_components/jquery.easing/jquery.easing.min.js"></script> <script src="/assets/bower_components/bootstrap/dist/js/bootstrap.bundle.min.js"></script> <script src="/assets/bower_components/jquery-mousewheel/jquery.mousewheel.min.js"></script> <script src="/assets/bower_components/lightgallery/dist/js/lightgallery-all.min.js"></script> <script src="//cdnjs.cloudflare.com/ajax/libs/picturefill/3.0.2/picturefill.min.js"></script> <script src="/assets/bower_components/imagesloaded/imagesloaded.pkgd.min.js"></script> <script src="/assets/bower_components/nanobar/nanobar.min.js"></script> <script src="//cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.js"></script> <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script> <!-- Github Button --> <script async defer src="//buttons.github.io/buttons.js"></script> <script src="//cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script> <script> ( function ( i, s, o, g, r, a, m ) { i[ 'GoogleAnalyticsObject' ] = r; i[ r ] = i[ r ] || function () { ( i[ r ].q = i[ r ].q || [] ).push( arguments ) }, i[ r ].l = 1 * new Date(); a = s.createElement( o ), m = s.getElementsByTagName( o )[ 0 ]; a.async = 1; a.src = g; m.parentNode.insertBefore( a, m ) } )( window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga' ); ga( 'create', 'UA-102170653-1', 'auto' ); ga( 'send', 'pageview' ); window.fbAsyncInit = function () { FB.init( { appId: '513486439531583', cookie: true, xfbml: true, version: 'v6.0' } ); FB.AppEvents.logPageView(); }; ( function ( d, s, id ) { var js, fjs = d.getElementsByTagName( s )[ 0 ]; if ( d.getElementById( id ) ) { return; } js = d.createElement( s ); js.id = id; js.src = "https://connect.facebook.net/en_US/sdk.js"; fjs.parentNode.insertBefore( js, fjs ); }( document, 'script', 'facebook-jssdk' ) ); </script> </head> <body> <div class="container-fluid"><header> <div class="col-lg-12"> <div class="row"> <nav class="navbar navbar-expand-lg fixed-top navbar-dark " id="topNav"> <!-- <a class="navbar-brand" href="#">Sumit Kar</a> --> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="/">Sumit Kar</a> <div class="collapse navbar-collapse" id="navbarNav"> <ul class="navbar-nav"> <li class="nav-item"> <a class="nav-link" href="https://www.sumitkar.in/about">About Me</a> </li> <li class="nav-item"> <a class="nav-link" href="https://blog.sumitkar.in/">Blog</a> </li> <li class="nav-item"> <a class="nav-link" href="https://www.sumitkar.in/contact">Contact Me</a> </li> </ul> </div> <ul class="nav justify-content-end"> <li class="nav-item"> <a class="nav-link" id="search-icon" href="https://www.sumitkar.in/search/"><i class="fa fa-search" aria-hidden="true"></i></a> </li> </ul> </nav> </div> </div> </header> <div class="col-lg-12"> <!-- Blog Post Breadcrumbs --><div class="col-lg-12"> <nav aria-label="breadcrumb" role="navigation"> <ol class="breadcrumb"> <li class="breadcrumb-item"> <a href="https://www.sumitkar.in/blog"><i class="fa fa-home" aria-hidden="true"></i></a> </li> <li class="breadcrumb-item active" aria-current="page"><a href="/tech/2020/05/13/ansible-basics/">Automating your deployments using Ansible</a></li> </ol> </nav> </div><div class="row" id="blog-post-container"> <div class="col-lg-8 offset-md-2"><article class="card" itemscope itemtype="http://schema.org/BlogPosting"> <div class="card-header"> <h4 class="post-meta">Automating your deployments using Ansible</h4> <h6 class="post-meta">Since the world is moving into the DevOps model, and the industry started focusing on automation, I thought of sharing something related to automation for deployment. Server-side deployment can be automated using several tools. One of which is Ansible. Ansible is a management tool that helps to maintain the cluster of machines.</h6> <p class="post-summary">Posted by : <img src="https://www.sumitkar.in/assets/img/sumit-kar.jpeg" class="author-profile-img"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name">Sumit Kar</span> </span> at <time datetime="2020-05-13 15:33:23 +0000" itemprop="datePublished">May 13, 2020</time> </p> <span class="disqus-comment-count" data-disqus-identifier="/tech/2020/05/13/ansible-basics/"></span> <div class="post-categories"> Category : <a href="/blog/categories/tech">tech</a> </div> </div> <div class="card-body" itemprop="articleBody"> <img class="card-img-top" src="https://www.sumitkar.in/assets/img/posts/ansible-basics.jpg" alt=""> <br /> <br /> <p>Since the world is moving into the DevOps model, and the industry started focusing on automation, I thought of sharing something related to automation for deployment. Server-side deployment can be automated using several tools. One of which is Ansible. Ansible is a management tool that helps to maintain the cluster of machines.</p> <p>There are several configuration-management tools out there why we should go with Ansible. For that there are below reasons</p> <ul> <li>Idempotent- Ansible’s whole architecture is structured around the concept of idempotency. The core idea here is that you only do things if they are needed and that things are repeatable without side effects.</li> <li>Agentless - There is no software that needs to be installed on the client system. We can use ansible as long we can ssh</li> <li>Modules - we create the new module in the ansible and add it to the ansible</li> <li>Tiny Learning Curve- Ansible is quite easy to learn. It doesn’t require any extra knowledge. With basic Linux knowledge this can be learnt.</li> </ul> <p>Ansible needs 3 files:</p> <p><strong>hosts</strong> [ Inventory file: This file can contain the list of servers. It can be a list of DNS name and IP. ]</p> <figure class="highlight">
    <pre><code class="language-yaml" data-lang="yaml"><span class="pi">[</span><span class="nv">web</span><span class="pi">]</span>
<span class="s">host1.example.com</span>
<span class="s">192.168.1.122</span>
<span class="s">host3.example.com</span>

<span class="pi">[</span><span class="nv">db</span><span class="pi">]</span>
<span class="s">host4.example.com</span>
<span class="s">host5.example.com</span>
<span class="s">host6.example.com</span></code></pre></figure> <p>The following code can added to try this locally</p> <figure class="highlight">
    <pre><code class="language-yaml" data-lang="yaml"><span class="pi">[</span><span class="nv">all</span><span class="pi">:</span><span class="nv">vars</span><span class="pi">]</span>
<span class="s">ansible_connection=local</span></code></pre></figure> <p><strong>ansible.cfg</strong> [ Config file ] Order of preference of confirguation file</p> <ol> <li>File specified by the ANSIBLE_CONFIG environment variable</li> <li>./ansible.cfg (ansible.cfg in the current directory)</li> <li>~/.ansible.cfg (.ansible.cfg in your home directory)</li> <li>/etc/ansible/ansible.cfg</li> </ol> <figure class="highlight">
    <pre><code class="language-yaml" data-lang="yaml"><span class="pi">[</span><span class="nv">defaults</span><span class="pi">]</span>
<span class="s">inventory = hosts</span> 
<span class="s">remote_tmp      = ~/.ansible/tmp</span>
<span class="s">local_tmp       = ~/.ansible/tmp</span>
<span class="s">remote_user = ubuntu</span> 
<span class="s">private_key_file = ansible.pem</span>
<span class="c1">#vault_password_file = /path/to/vault_password_file</span>
<span class="c1">#executable = /bin/sh</span>
<span class="c1">#ask_pass        = False</span>
<span class="s">host_key_checking = False</span> 
<span class="s">interpreter_python = auto</span>
<span class="pi">[</span><span class="nv">privilege_escalation</span><span class="pi">]</span>
<span class="c1">#become = False</span>
<span class="c1">#become_method = sudo</span>
<span class="c1">#become_ask_pass = False</span>


<span class="pi">[</span><span class="nv">persistent_connection</span><span class="pi">]</span>
<span class="c1">#connect_timeout = 30</span>
<span class="c1">#command_timeout = 30</span></code></pre></figure> <p><strong>play-nginx.yml</strong> [Play file]</p> <figure class="highlight">
    <pre><code class="language-yaml" data-lang="yaml"><span class="nn">---</span>
<span class="pi">-</span> <span class="na">hosts</span><span class="pi">:</span> <span class="s">web</span>
  <span class="na">become</span><span class="pi">:</span> <span class="s">yes</span>
  <span class="na">tasks</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">ensure nginx is at the latest version</span>
      <span class="na">apt</span><span class="pi">:</span> <span class="s">name=nginx state=latest</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">copy the content of the web site</span>
      <span class="na">copy</span><span class="pi">:</span>
        <span class="na">src</span><span class="pi">:</span> <span class="s">index.html</span>
        <span class="na">dest</span><span class="pi">:</span> <span class="s">/var/www/html/</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">start nginx</span>
      <span class="na">service</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">nginx</span>
          <span class="na">state</span><span class="pi">:</span> <span class="s">started</span></code></pre></figure> <h3 id="ansible-ad-hoc-command">Ansible Ad-hoc command</h3> <p>The Ad-Hoc command is the one-liner ansible command that performs one task on the target host. It allows you to execute simple one-line task against one or group of hosts defined on the inventory file configuration.</p> <p>adhoc command has the two parts List of host that you want to run the module ansible module to run</p> <p><code class="language-html highlighter-rouge">$ ansible all -m ping</code></p> <p>The first parameter all tells we are performing the task against the all host The second parameter m tells we are going to use ping module</p> <p>To Know the list of modules type the below command in the terminal</p> <p><code class="language-html highlighter-rouge">$ ansible-doc -l | more</code></p> <p>To Find the detail of modules</p> <p><code class="language-html highlighter-rouge">$ ansible-doc <span class="nt">&lt;module-name&gt;</span></code></p> <h2 id="performing-basic-task-using-ansible-command">Performing basic task using ansible command</h2> <h3 id="installing-packages">Installing packages</h3> <p><strong>Run the below command in the terminal and see the output</strong></p> <p><code class="language-html highlighter-rouge">$ ansible testserver -m shell -a "whoami"</code></p> <p><strong>Run the below command in the terminal and see the output and compare with above one</strong></p> <p><code class="language-html highlighter-rouge">$ ansible testserver -m shell -a "whoami" --become</code> [ <code class="language-html highlighter-rouge">--become</code> is a parameter used to become root user ]</p> <p><strong>Type the below command in the terminal to install nginx</strong></p> <p><code class="language-html highlighter-rouge">$ ansible testserver -m apt -a 'name=nginx state=latest' --become</code></p> <p><strong>starting the services : Run the below command in the terminal to start the service</strong></p> <p><code class="language-html highlighter-rouge">$ ansible -m service -a "name=nginx state=started enabled=yes" testserver --become</code></p> <p><strong>Run the below command in the terminal to see ths status of the ngnix</strong></p> <p><code class="language-html highlighter-rouge">$ ansible testserver -m shell -a "service nginx status" --become</code></p> <p><strong>Run the below command to stop the service</strong></p> <p><code class="language-html highlighter-rouge">$ ansible -m service -a "name=nginx state=stopped enabled=yes" testserver --become</code></p> <h3 id="file-module">File module</h3> <p><strong>Run the below command in the terminal to find the existence of the folder</strong> <code class="language-html highlighter-rouge">$ ansible -m file -a "path=/usr/share/nginx/html state=directory" testserver --become</code></p> <p><strong>Copy module: Run the below command in the terminal to copy the file from host to node (Copy module take 2 parameter : Source and Destination)</strong></p> <p><code class="language-html highlighter-rouge">$ ansible -m copy -a "src=a.txt dest=/usr/share/nginx/html/" testserver --become</code></p> <h3 id="ansible-setup-module">Ansible setup module</h3> <p><strong>The setup module is used to gather the information about the host</strong><br /> <code class="language-html highlighter-rouge">$ ansible testserver -m setup</code> <code class="language-html highlighter-rouge">$ ansible testserver -m setup -a "filter=*ipv4"</code></p> <h2 id="writing-your-first-playbook">Writing your first playbook</h2> <p>Playbooks are list of plays grouped together and plays is group of tasks and task call modules Playbooks are generally written in the yaml format Note : we can also write the playbook in the json format</p> <p>To run the playbook we can simply use the ansible-playbook and followed by the playbook name</p> <p>Every playbook has 2 components</p> <ul> <li>hosts - list of host in which we want to run the task</li> <li>task - task need to be performed</li> </ul> <p><strong>Run the below command</strong></p> <p><code class="language-html highlighter-rouge">$ ansible-playbook <span class="nt">&lt;playbook-name&gt;</span>.yaml</code></p> <p><strong>To know whether the syntax of the playbook was correct we can use</strong></p> <p><code class="language-html highlighter-rouge">$ ansible-playbook --syntax-check <span class="nt">&lt;playbook-name&gt;</span>.yaml</code></p> <h2 id="ansible-roles">Ansible Roles</h2> <p>Roles in Ansible are next level abstraction of playbook Roles are way to organize the playbook in the efficient manner so that we can use it later. Type the below command to see the list of command of available using the ansible-galaxy</p> <p><code class="language-html highlighter-rouge">$ ansible-galaxy -h</code></p> <p>The syntax to create the role was</p> <p><code class="language-html highlighter-rouge">$ ansible-galaxy init <span class="nt">&lt;role-name&gt;</span></code></p> <p>Files inside the Role</p> <ul> <li>Default - Data about the role / application default variable eg:port no</li> <li>files - put the static files</li> <li>Handlers - handler are kept here</li> <li>meta - Information about the role</li> <li>task - Task are kept here</li> <li>templates - Similar to files but they are dynaimic</li> <li>vars - Same as Default it has high prority</li> </ul> <h2 id="ansible-vault">Ansible Vault</h2> <p>Ansible vault to encrypt the playbook and store them safely Basic Ansible vault command</p> <ul> <li>create</li> <li>encrypt</li> <li>decrypt</li> <li>view</li> <li>rekey</li> </ul> <h3 id="create">Create</h3> <p>Type the below command in the terminal to create the playbook</p> <p><code class="language-html highlighter-rouge">$ ansible-vault create filename.yaml</code></p> <h3 id="edit">Edit</h3> <p>Type the below command in the terminal to edit the encrypted playbook</p> <p><code class="language-html highlighter-rouge">$ ansible-vault edit filename.yaml</code></p> <h3 id="view">View</h3> <p>Type the below command in the terminal to view the encrypted playbook</p> <p><code class="language-html highlighter-rouge">$ ansible-vault view filename.yaml</code></p> <h3 id="rekey">Rekey</h3> <p>Rekey is the command used to change the password</p> <p><code class="language-html highlighter-rouge">$ ansible-vault rekey filename.yaml</code></p> <h3 id="encrypt">Encrypt</h3> <p>Type the below command in the terminal to encrypt the existing playbook</p> <p><code class="language-html highlighter-rouge">$ ansible-vault view filename.yaml</code></p> <h3 id="decrypt">Decrypt</h3> <p>Type the below command in the terminal to de-encrypt the existing playbook</p> <p><code class="language-html highlighter-rouge">$ ansible-vault view filename.yaml</code></p> <h3 id="running-the-encrypted-playbook">Running the encrypted playbook</h3> <p>Type the below command in the terminal to run the encrypted playbook <code class="language-html highlighter-rouge">$ ansible-playbook filename.yml --ask-vault-pass</code></p> <p>Ansible is a powerful tool and this can not only be used for automating deployment. It is also used to harden Operating System and applying patch.</p> <p>Try out basic ansible commands : https://github.com/karsumit94/ansible-example</p> </div> <div id="disqus_thread"></div> </article><script> var disqus_config = function () { this.page.url = "https://www.sumitkar.in/tech/2020/05/13/ansible-basics/"; /* Replace PAGE_URL with your page's canonical URL variable */ this.page.identifier = "/tech/2020/05/13/ansible-basics"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */ }; ( function () { /* DON'T EDIT BELOW THIS LINE */ var d = document, s = d.createElement( 'script' ); s.src = 'https://timusrak94.disqus.com/embed.js'; s.setAttribute( 'data-timestamp', +new Date() ); ( d.head || d.body ).appendChild( s ); } )(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript></div> </div> <!-- End of row--> <div class="row"> <div class="col-md-4"> <div class="card"> <div class="card-header"> About </div> <div class="card-body"> <p class="author_bio"> </p> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Categories </div> <div class="card-body text-dark"> <div id="#books"></div> <li class="tag-head"> <a href="/blog/categories/books">books</a> </li> <a name="books"></a> <div id="#corona"></div> <li class="tag-head"> <a href="/blog/categories/corona">corona</a> </li> <a name="corona"></a> <div id="#tech"></div> <li class="tag-head"> <a href="/blog/categories/tech">tech</a> </li> <a name="tech"></a> <div id="#finance"></div> <li class="tag-head"> <a href="/blog/categories/finance">finance</a> </li> <a name="finance"></a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Useful Links </div> <div class="card-body text-dark"> <li> <a href="https://www.sumitkar.in/about">About Me</a> </li> <li> <a href="https://www.sumitkar.inhttps://blog.sumitkar.in/">Blog</a> </li> <li> <a href="https://www.sumitkar.in/contact">Contact Me</a> </li> </div> </div> </div> </div> </div><footer> <p> Hosted at <a href="https://pages.github.com">Github</a>. </p> </footer> </div> <script> var options = { classname: 'my-class', id: 'my-id' }; var nanobar = new Nanobar( options ); nanobar.go( 30 ); nanobar.go( 76 ); nanobar.go( 100 ); </script> </div> </body> </html>